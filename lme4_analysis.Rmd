---
title: "Analysis of split plot design using lme4"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ProjectTemplate)
load.project()
```

## Notes on This Analysis Before Starting

The base levels for this analysis are:

- 2015 `NRTE:0`

- 2015 `WMGT:FLD`

- 2016 `NRTE:60`

- 2016 `WMGT:FLD`

#### Changes between 2015 and 2016

Before the analysis, note that due to changes between the years, the analysis
must be carried out on each year separately. The 2015 data and 2016 data cannot
be combined due to changes in inoculation methods; there are other changes too,
but the main one is this. Therefore, the analyses will be conducted separately
such that comparisons will only be observational and cannot be statistically
compared.

## Setup

The `AUDPS` object is created when the project is loaded, in the file [munge/03_preprocess_data.R](./munge/03_preprocess_data.R). However, because it is a `tibble` and the treatments exist in a single column for graphing the raw data, this object needs a few minor changes to be usable for the analysis.

Create individual data frames for the analysis.

```{r create_analysis_df}
AUDPS_2015 <- as.data.frame(AUDPS[AUDPS$YEAR == 2015, ])
AUDPS_2015 <- droplevels(AUDPS_2015)

# relevel factors for easier interpretation of  analysis
AUDPS_2015 <- within(AUDPS_2015, NRTE <- relevel(NRTE, ref = "N0"))
AUDPS_2015 <- within(AUDPS_2015, WMGT <- relevel(WMGT, ref = "FLD"))

AUDPS_2016 <- as.data.frame(AUDPS[AUDPS$YEAR == 2016, ])
AUDPS_2016 <- droplevels(AUDPS_2016)

# relevel factors for easier interpretation of  analysis
AUDPS_2016 <- within(AUDPS_2016, NRTE <- relevel(NRTE, ref = "N60"))
AUDPS_2016 <- within(AUDPS_2016, WMGT <- relevel(WMGT, ref = "FLD"))
```

Now that the `AUDPS_2015` and `AUDPS_2016` `data.frames` exist, we can start the analysis.

## 2015

### 2015 Tiller Sheath Blight Incidence Model

```{r 2015_TShB_incidence}
library(lme4)
library(lsmeans)
TShB_inc_AUDPS <- lmer(TShB_inc_AUDPS ~ WMGT + NRTE + (1|REP), data = AUDPS_2015)
print(summary(TShB_inc_AUDPS), correlation = FALSE)

plot(TShB_inc_AUDPS)
qqnorm(residuals(TShB_inc_AUDPS))
qqline(residuals(TShB_inc_AUDPS))

print(lsmeans(TShB_inc_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(TShB_inc_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

### 2015 Tiller Sheath Blight Severity Model

```{r 2015_TShB_severity}
TShB_sev_AUDPS <- lmer(TShB_percent_AUDPS ~ WMGT * NRTE + (1|REP), data = AUDPS_2015)
print(summary(TShB_sev_AUDPS), correlation = FALSE)

plot(TShB_sev_AUDPS)
qqnorm(resid(TShB_sev_AUDPS))
qqline(resid(TShB_sev_AUDPS))

print(lsmeans(TShB_sev_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(TShB_sev_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

### 2015 Leaf Sheath Blight Severity Model

```{r 2015_LShB_severity}
LShB_sev_AUDPS <- lmer(LShB_percent_AUDPS ~ WMGT + NRTE + (1|REP), data = AUDPS_2015)
print(summary(LShB_sev_AUDPS), correlation = FALSE)

plot(LShB_sev_AUDPS)
qqnorm(resid(LShB_sev_AUDPS))
qqline(resid(LShB_sev_AUDPS))

print(lsmeans(LShB_sev_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(LShB_sev_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

*******

## 2016

### 2016 Tiller Sheath Blight Incidence Model

```{r 2016_TShB_incidence}
TShB_inc_AUDPS <- lmer(TShB_inc_AUDPS ~ WMGT + NRTE + (1|REP), data = AUDPS_2016)
print(summary(TShB_inc_AUDPS), correlation = FALSE)

plot(TShB_inc_AUDPS)
qqnorm(resid(TShB_inc_AUDPS))
qqline(resid(TShB_inc_AUDPS))

print(lsmeans(TShB_inc_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(TShB_inc_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

### 2016 Tiller Sheath Blight Severity Model

```{r 2016_TShB_severity}
TShB_sev_AUDPS <- lmer(TShB_percent_AUDPS ~ WMGT + NRTE + (1|REP), data = AUDPS_2016)
print(summary(TShB_sev_AUDPS), correlation = FALSE)

plot(TShB_sev_AUDPS)
qqnorm(resid(TShB_sev_AUDPS))
qqline(resid(TShB_sev_AUDPS))

print(lsmeans(TShB_sev_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(TShB_sev_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

### 2016 Leaf Sheath Blight Severity Model

```{r 2016_LShB_severity}
LShB_sev_AUDPS <- lmer(LShB_percent_AUDPS ~ WMGT + NRTE + (1|REP), data = AUDPS_2016)
print(summary(LShB_sev_AUDPS), correlation = FALSE)

plot(LShB_sev_AUDPS)
qqnorm(resid(LShB_sev_AUDPS))
qqline(resid(LShB_sev_AUDPS))

print(lsmeans(LShB_sev_AUDPS, list(pairwise ~ NRTE)), adjust = c("tukey"))
print(lsmeans(LShB_sev_AUDPS, list(pairwise ~ WMGT)), adjust = c("tukey"))
```

## Conclusions


## Conclusions

### Tiller Sheath Blight Incidence

In 2015 both the nitrogen rates, N100 and N120, were significant when compared with the base N0 rate, water management was not significant.

In 2016 the nitrogen rate N180, was significantly different than the base N60 rate, water management was not significant.


### Tiller Sheath Blight Severity

In 2015 both the N100 and N120 rates were significantly different than the N0 treatment. The AWD water management was also significantly different from the base flooding treatment.

In 2016 the N180 was significantly different from the N60 rate. The AWD water management was also significantly different from the base flooding treatment.

### Leaf Sheath Blight Severity

In 2015 both the N100 and N120 rates were significantly different than the N0 treatment. The AWD water management was also significantly different from the base flooding treatment.

In 2016 the none of the treatments, nitrogen rate or water management, were significantly different from the base treatment for leaf sheath blight severity.

## R Session Info

```{r session_info, echo=FALSE}
devtools::session_info()
```
